#! /bin/bash

set -e

DOTFILES=$(cd $(dirname "${BASH_SOURCE[0]:-$0}") && pwd | sed -e s/\\/$//g)

. "$DOTFILES/includes/functions.sh"
. "$DOTFILES/includes/config.sh"

echo "Installing..."

#
# Install the startup script.
#
GREPTERM="dotfiles-init"

if [ ! -f "$HOME/.profile" ]; then
  touch "$HOME/profile"
else
  sed -i.bak "/$GREPTERM/d" "$HOME/.profile"
  rm -f "$HOME/.profile.bak"
fi

echo "source \"$DOTFILES/scripts/startup.sh\" # $GREPTERM" >> "$HOME/.profile"

install_files "$DOTFILES/home" "$HOME"
install_files "$PLATFORM_DIR/home" "$HOME"

pull_git_repo "https://github.com/pyenv/pyenv.git" "$DOTFILES/external/pyenv"
if [ -d "$DOTFILES/external/pyenv" ]; then
  pull_git_repo https://github.com/pyenv/pyenv-virtualenv.git "$DOTFILES/external/pyenv/plugins/pyenv-virtualenv"
fi

maybe_source "$PLATFORM_DIR/install.sh"
